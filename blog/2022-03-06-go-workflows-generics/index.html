<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v9.1.6 <https://hydejack.com/>
--><head><title>go-workflows: Experiments with Go Generics | cschleiden</title><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="go-workflows: Experiments with Go Generics" /><meta name="author" content="Christopher Schleiden" /><meta property="og:locale" content="en" /><meta name="description" content="This is not the promised part 2 of the go-workflows: Durable Workflows in Go series but a summary of some experiments I did with the Go Generics support in the context of go-workflows." /><meta property="og:description" content="This is not the promised part 2 of the go-workflows: Durable Workflows in Go series but a summary of some experiments I did with the Go Generics support in the context of go-workflows." /><link rel="canonical" href="https://cschleiden.dev/blog/2022-03-06-go-workflows-generics/" /><meta property="og:url" content="https://cschleiden.dev/blog/2022-03-06-go-workflows-generics/" /><meta property="og:site_name" content="cschleiden" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-06T18:30:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="go-workflows: Experiments with Go Generics" /><meta name="twitter:site" content="@cschleiden" /><meta name="twitter:creator" content="@cschleiden" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Christopher Schleiden"},"dateModified":"2023-01-16T02:35:41+00:00","datePublished":"2022-03-06T18:30:00+00:00","description":"This is not the promised part 2 of the go-workflows: Durable Workflows in Go series but a summary of some experiments I did with the Go Generics support in the context of go-workflows.","headline":"go-workflows: Experiments with Go Generics","mainEntityOfPage":{"@type":"WebPage","@id":"https://cschleiden.dev/blog/2022-03-06-go-workflows-generics/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://cschleiden.dev/assets/icons/icon.png"},"name":"Christopher Schleiden"},"url":"https://cschleiden.dev/blog/2022-03-06-go-workflows-generics/"}</script><meta name="theme-color" content="rgb(25,55,71)"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="cschleiden"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="cschleiden"><meta name="generator" content="Hydejack v9.1.6" /><link rel="alternate" href="https://cschleiden.dev/blog/2022-03-06-go-workflows-generics/" hreflang="en"><link type="application/atom+xml" rel="alternate" href="https://cschleiden.dev/feed.xml" title="cschleiden" /><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"> <script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script"),e=(n.src=e,t&&a(n,"load",t,{once:!0}),c.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/'; w._publicPath = '/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = true; w._search = { DATA_URL: '/assets/sitedata.json?no-cache', STORAGE_KEY: 'mini-search/', INDEX_KEY: 'index--2023-01-16T02:35:47+00:00', }; w._clapButton = false; }(window);</script> <script async src="/assets/bower_components/MathJax/es5/tex-mml-chtml.js" id="_MathJax"></script> <!--[if gt IE 8]><!----><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,.content .avatar,.nav-btn,.nav-btn-bar,.navbar,.message,.note-sm,#markdown-toc,.note,.hr-bottom,.hr-after::after,hr,.hr,p,body{transition:none}html{--font-family: Noto Sans,Helvetica,Arial,sans-serif;--font-family-heading: Roboto Slab,Helvetica,Arial,sans-serif;--code-font-family: ui-monospace,Menlo,Monaco,Cascadia Mono,Segoe UI Mono,Roboto Mono,Oxygen Mono,Ubuntu Monospace,Source Code Pro,Fira Mono,Droid Sans Mono,Courier New,monospace;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--inv-body-color: #ccc;--inv-body-bg: #282828;--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 700;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 1664px}html .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem;margin-bottom:1.5rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f6,h6,.h6,.f5,h5,.h5,.f4,.sidebar-nav-item,h4,.h4,.post-date,.f3,h3,.h3,.f2,h2,.h2,.f1,h1,.h1{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,.sidebar-nav-item,h4,.h4,.post-date{font-size:1.08rem;line-height:1.6}.f5,h5,.h5{font-size:1.04rem;line-height:1.7}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 1664px){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:4rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:4rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:3rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:2rem}@media screen and (min-width: 1664px){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:flex;justify-content:space-between;margin-top:-.6rem;height:2rem;margin-bottom:.85rem;color:var(--gray)}.post-date>.ellipsis,#breadcrumbs.post-date>ul{cursor:pointer}.post-date [class^="icon-"]{display:inline-block;font-size:smaller;margin-right:.25rem}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,#markdown-toc,.note{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,#markdown-toc,.note{background:transparent;color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.2rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,#markdown-toc:before,.note:before{font-size:0.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,#markdown-toc[title]:before,.note[title]:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:'';width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media (min-width: 64em){body::before{width:21rem}}@media (min-width: 1664px){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}#breadcrumbs>ul{height:1rem;margin:-1.5rem 0 .5rem;padding:0;font-size:.667rem;color:var(--menu-text);text-transform:uppercase;width:100%;list-style:none}#breadcrumbs>ul>li{display:inline}#breadcrumbs>ul>li a{color:var(--gray);text-decoration:none;border-bottom:none}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.ml1{margin-left:1rem}.mr1{margin-right:1rem}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.larger{font-size:larger}.smaller{font-size:smaller}.clearfix,.sidebar-social::after{content:"";display:table;clear:both}.ellipsis,#breadcrumbs>ul{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.border{border:1px solid var(--border-color)}@media (min-width: 42em){.border-radius,.lead,.page .aspect-ratio.sixteen-nine.lead{border-radius:.5rem}}.fallback-img{background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1664px){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,0.75);text-align:center;min-height:100vh}.sidebar.invert{color:rgba(32,32,32,0.75)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2);text-decoration-color:rgba(255,255,255,0.2)}.sidebar.invert a{color:#222;border-bottom-color:rgba(32,32,32,0.2);text-decoration-color:rgba(32,32,32,0.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 50%, rgba(32,32,32,0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:'';display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,0.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar.invert .sidebar-about>a.sidebar-title::after{border-color:rgba(32,32,32,0.2)}.sidebar.invert .sidebar-about>a.sidebar-title:hover::after{border-color:#222}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media (min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-bottom,.fixed-top{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:white;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 1664px){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:20.5rem;right:0;margin:auto;overflow:auto}}@media screen and (min-width: 1664px){body.no-break-layout:not(.no-toc) #markdown-toc{width:calc(50% - 31rem)}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;min-height:100vh}}@media screen and (min-width: 42em){.content{max-width:42rem}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{padding-top:9rem;margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 1664px){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 1664px){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"}html{--accent-color: rgb(79,177,186);--accent-color-faded: rgba(79,177,186,0.5);--accent-color-highlight: rgba(79,177,186,0.1);--accent-color-darkened: #409ba3;--theme-color: rgb(25,55,71)}</style><link rel="preload" as="style" href="/assets/css/hydejack-9.1.6.css" id="_stylePreload"><link rel="preload" as="style" href="/assets/icomoon/style.css" id="_iconsPreload"><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Roboto+Slab:400%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/setRel('_fontsPreload');/**/ </script> <noscript><link rel="stylesheet" href="/assets/css/hydejack-9.1.6.css"><link rel="stylesheet" href="/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:400%7CNoto+Sans:400,400i,700,700i&display=swap"> </noscript> <!--<![endif]--><body class="no-large-headings"> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange ><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-post" role="main" ><nav id="breadcrumbs" class="screen-only"><ul><li><a href="/">home</a><li> <span>/</span> <a href="/blog/">blog</a><li> <span>/</span> <span>2022-03-06-go-workflows-generics</span></ul></nav><article id="post-blog-go-workflows-generics" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> go-workflows: Experiments with Go Generics</h1><div class="post-date"> <span class="ellipsis mr1"> <time datetime="2022-03-06T18:30:00+00:00">06 Mar 2022</time> in <span>Blog</span> </span></div><div class="hr pb0"></div></header><p>This is not the promised part 2 of the <a href="/blog/2022-02-13-go-workflows-part1/">go-workflows: Durable Workflows in Go</a> series but a summary of some experiments I did with the Go Generics support in the context of go-workflows.<p>With Go 1.18 (finally) including support for Generics, I wanted to see how I could improve the API of go-workflows by taking advantage of Generics. Specificially calls like this which occur in a few different scenarios:<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// An activity</span>
<span class="k">func</span> <span class="n">SomeSideEffect</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">count</span> <span class="kt">int</span><span class="p">,</span> <span class="n">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>

<span class="c">// A workflow scheduling/executing an activity</span>
<span class="k">func</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">ctx</span> <span class="n">workflow</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">f</span> <span class="o">:=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">ExecuteActivity</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">SomeSideEffect</span><span class="p">,</span> <span class="m">42</span><span class="p">,</span> <span class="s">"Hello"</span><span class="p">)</span>

  <span class="k">var</span> <span class="n">result</span> <span class="kt">bool</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">f</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="c">// handle error</span>
  <span class="p">}</span>

  <span class="c">// Check `result`</span>
<span class="p">}</span>
</code></pre></div></div><p>As mentioned in the last <a href="/blog/2022-02-13-go-workflows-part1/">post</a>, every side effect has to be executed as an <em>Activity</em>, which is a function that’s executed only once and its result is recorded in the event sourced history of the workflow.<p>In the example above, <code class="language-plaintext highlighter-rouge">SomeSideEffect</code> takes two inputs: <code class="language-plaintext highlighter-rouge">count</code> and <code class="language-plaintext highlighter-rouge">msg</code> and returns a boolean result and an optional error. When the activity is executed from the workflow, the scheduler returns a Future <code class="language-plaintext highlighter-rouge">f</code> from where we can get the <code class="language-plaintext highlighter-rouge">bool</code> result. This works, but there are a couple things I don’t like about this:<p>I cannot define a type for an activity that <code class="language-plaintext highlighter-rouge">ExecuteActivity</code> accepts. Activities can have zero or more parameters, and can return zero or more results plus the error. Therefore <code class="language-plaintext highlighter-rouge">ExcuteActivity</code>’s signature currently has to look like this:<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">ExecuteActivity</span><span class="p">(</span><span class="c">/*...*/</span><span class="p">,</span> <span class="n">activity</span> <span class="k">interface</span><span class="p">{},</span> <span class="n">args</span> <span class="o">...</span><span class="k">interface</span><span class="p">{})</span> <span class="n">Future</span>
</code></pre></div></div><p>I can check that the number of passed arguments matches the activity signature, but that has to happen at runtime via reflection. That means if it’s a long running workflow, you get feedback about problems only once the activity is scheduled.<p>The other problem I have with the current approach is that <code class="language-plaintext highlighter-rouge">ExecuteActivity</code> has to return a generic <code class="language-plaintext highlighter-rouge">Future</code> that could represent any result. When waiting for its result, you have to know what the return type of the scheduled activity is, declare a variable of that type and then call <code class="language-plaintext highlighter-rouge">Get</code> with a pointer to that variable:<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">result</span> <span class="kt">bool</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">f</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
</code></pre></div></div><p>Here again, you only get feedback about any potential mismatch at runtime, when trying to get the result of the future. If <code class="language-plaintext highlighter-rouge">SomeSideEffect</code>’s return type changes in the future, the compiler cannot provide any help about now mismatched <code class="language-plaintext highlighter-rouge">Get</code> calls.<p>I’ve always been a fan of statically typed languages and relying on the compiler to provide as much help as possible. Dynamic typing is great and flexible when writing, but often require a pretty detailed mental model of how the code works when reading it later.<h2 id="generics-to-improve-type-safety">Generics to improve type-safety</h2><h3 id="primitives">Primitives</h3><p>With Go’s <a href="https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md">Type Parameters Proposal</a> aka Generics landing in the 1.18 betas and (as of now) the RC1, we can try to improve this.<p>The first change was straight-forward: make the <code class="language-plaintext highlighter-rouge">Future</code> type generic, with the signature changing to:<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Future</span><span class="p">[</span><span class="n">T</span> <span class="n">any</span><span class="p">]</span> <span class="k">interface</span> <span class="p">{</span>
	<span class="n">Get</span><span class="p">(</span><span class="n">ctx</span> <span class="n">Context</span><span class="p">)</span> <span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><p>With that, the requirement to pass a pointer to <code class="language-plaintext highlighter-rouge">Get</code> is gone and instead you can use it like:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>result, err := f.Get(ctx)
</code></pre></div></div><p>which feels a lot more natural, especially comparing it to future/promise usage in other languages.<p>I’ve also updated all the other primitives required for the deterministic execution like <code class="language-plaintext highlighter-rouge">Channel</code>, the custom <code class="language-plaintext highlighter-rouge">Selector</code> etc.<h3 id="wanted-behavior-for-executeactivity">Wanted behavior for <code class="language-plaintext highlighter-rouge">ExecuteActivity</code></h3><p>The next step was to improve the API of <code class="language-plaintext highlighter-rouge">ExecuteActivity</code> (and <code class="language-plaintext highlighter-rouge">ExecuteSubWorkflow</code> etc.) to make it more type-safe. Specifically I wanted to:<ul><li>automatically infer the result of an activity to create the correct <code class="language-plaintext highlighter-rouge">Future[T]</code> type automatically<li>validate that the types of any passed arguments match the activity signature</ul><p>I have written a lot of TypeScript and there I could write the functions like this (<a href="https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgGIFczqhAPAFQD5kBvAKGWQHEIwAKASgC5l8BuMgXzLNElkQoAggjDAAbsDABPAgEkQAB0zIIAD0ggAJgGdkcENIDaAXQA0rAEoQd6ADZhi5SnQB07uFADmOlvgXKYMxWNvZgHNxkMOggosAA9iDIAKJqEAiYECJikjLySirqmrr6hqYW+Na2DoR0iDlS0izZEo35gRVVYYQW7q6ePn4BmMEYWDgEXTWkFMg440kknPp6Y9h4laE1ETwA9Ps80bFiicgAyvEAthBnwFoQyTAw6fQI8TFgLCDolwBG0BZLjovCwdGAoKAvMEjL94vE7BADBYwRCQF4TDNKPNsEkjOD0BALAAiIkmHZRGJxU4AdXiUAA1jA7PEAO6MTHIN4gMHIGDIAC8KTSGUgLVy0joF2ut3uj2eogsABYAEzEgAWEDszKJDA4lC5PKMOGqYAs0CgdIxgpgrho9F1s32lGdlAAeshYfCLMh3SjIcguGQgA">Playground</a>):<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">Future</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="nx">Get</span><span class="p">():</span> <span class="nx">T</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">Activity</span><span class="o">&lt;</span><span class="nx">TInput</span> <span class="kd">extends</span> <span class="kr">any</span><span class="p">[],</span> <span class="nx">TResult</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="p">(...</span><span class="na">args</span><span class="p">:</span> <span class="nx">TInput</span><span class="p">):</span> <span class="nx">TResult</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ExecuteActivity</span><span class="o">&lt;</span><span class="nx">TInput</span> <span class="kd">extends</span> <span class="kr">any</span><span class="p">[],</span> <span class="nx">TResult</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">activity</span><span class="p">:</span> <span class="nx">Activity</span><span class="o">&lt;</span><span class="nx">TInput</span><span class="p">,</span> <span class="nx">TResult</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">:</span> <span class="nx">TInput</span><span class="p">):</span> <span class="nx">Future</span><span class="o">&lt;</span><span class="nx">TResult</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{}</span> <span class="k">as</span> <span class="nx">Future</span><span class="o">&lt;</span><span class="nx">TResult</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">///</span>

<span class="kd">function</span> <span class="nx">SomeSideEffect</span><span class="p">(</span><span class="nx">count</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">msg</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="p">{</span> <span class="nl">result</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span> <span class="nl">error</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span> <span class="na">result</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">error</span><span class="p">:</span> <span class="dl">""</span> <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Workflow</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">ExecuteActivity</span><span class="p">(</span><span class="nx">SomeSideEffect</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="dl">"</span><span class="s2">hello</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">error</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Get</span><span class="p">();</span>
  <span class="c1">//       ^ bool,  ^ string</span>
<span class="p">}</span>

</code></pre></div></div><p><em>TypeScript (or JavaScript for that matter) does not natively support multiple return types, so for this example I’ve used another tuple type to mimic the Go signature and keep it concise.</em><p>This uses TypeScript’s support for variadic generic tuples. It allows us to infer the types of the arguments the activity expects, and then check that the arguments passed to <code class="language-plaintext highlighter-rouge">ExecuteActivity</code> match those.<p>If you look at the help provided by the language server for the invocation of <code class="language-plaintext highlighter-rouge">ExecuteActivity</code> you can see that it’s infered the following arguments:<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">ExecuteActivity</span><span class="o">&lt;</span><span class="p">[</span><span class="kr">number</span><span class="p">,</span> <span class="kr">string</span><span class="p">],</span> <span class="p">[</span><span class="nx">boolean</span><span class="p">,</span> <span class="kr">string</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">activity</span><span class="p">:</span> <span class="nx">Activity</span><span class="o">&lt;</span><span class="p">[</span><span class="kr">number</span><span class="p">,</span> <span class="kr">string</span><span class="p">],</span> <span class="p">[</span><span class="nx">boolean</span><span class="p">,</span> <span class="kr">string</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">args_0</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">args_1</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">Future</span><span class="o">&lt;</span><span class="p">[</span><span class="nx">boolean</span><span class="p">,</span> <span class="kr">string</span><span class="p">]</span><span class="o">&gt;</span>
</code></pre></div></div><p>So it knows the return type and therefore what <code class="language-plaintext highlighter-rouge">Future</code> the function returns, and also the number of arguments and the types of the <code class="language-plaintext highlighter-rouge">args_x</code> parameters.<p>Next I tried to bring this behavior to the Go API. Unfortunately, Go does not support variadic generic arguments (yet). There are some issues discussing the missing support, but given how long it took to get to this first version of Generics - and how contentious it was - it makes sense to start simpler, and then see if the support needs to be added later. Unfortunately, that means I cannot provide the same API with type-checked arguments as I did in the TypeScript sample.<h3 id="go-generics---approach-1-infer-result">Go Generics - Approach 1: infer result</h3><p>I knew that Go’s generic support isn’t as expressive as TypeScript’s yet, so I wanted to start simple. Could I keep the current runtime argument checking and just infer the result type?<p>To again start with a TypeScript example (<a href="https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgGIFczqhAPAFQD5kBvAKGWQHEIwAKASgC5l8BuMgXzLNElkQoAggjDAAbsDABPAgCUIAZ3QAbMMXKU6AOl1woAc0Us4Iac1YLlajtzIx0IUcAD2IZAFEAHhASYIImKSMvJKqup0iEFS0iyBEjGh1uoANMi62vpGJmYA2gC6FhhYOEnhGhTIOCXuJJzIcIpomNh4+FbltjwA9L08Dk5ibsgAyi4AthAjwAAmEB4wML70CC6OYCwg6OMARtBp44oGLIpgUKAGFrk7Li4qEKZpp+cgBvmkldXY7rln6BBpABEgPyXXsjmcwwA6i4oABrGAqFwAd0YH0oqxAp2QMGQAF5PD4-JB4sFpHQxpNpnMFktRGkACwAJiBAAsICokYCGGxkL0GoZthBwE0QC4wMgEOyEHCZhR+ZjsTAmfjCb5-KSYhSJlNZvNFstGSzkID2ZyXICgYodWBWRdkBzFBBubz+WLJRMAA7Ae5QB1QKCwyqKiW5HDJNLQQNQd4EmDaGj0HmVfmUNPIAB6yBudzSmeQz3tXDIQA">Playground</a>):<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">Activity</span><span class="o">&lt;</span><span class="nx">TResult</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="p">(...</span><span class="na">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">):</span> <span class="nx">TResult</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ExecuteActivity</span><span class="o">&lt;</span><span class="nx">TResult</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">activity</span><span class="p">:</span> <span class="nx">Activity</span><span class="o">&lt;</span><span class="nx">TResult</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">:</span> <span class="kr">any</span><span class="p">[]):</span> <span class="nx">Future</span><span class="o">&lt;</span><span class="nx">TResult</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{}</span> <span class="k">as</span> <span class="nx">Future</span><span class="o">&lt;</span><span class="nx">TResult</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">///</span>

<span class="kd">function</span> <span class="nx">SomeSideEffect</span><span class="p">(</span><span class="nx">count</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">msg</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="p">[</span><span class="nx">boolean</span><span class="p">,</span> <span class="kr">string</span><span class="p">]</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span><span class="kc">true</span><span class="p">,</span> <span class="dl">""</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Workflow</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">ExecuteActivity</span><span class="p">(</span><span class="nx">SomeSideEffect</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="dl">"</span><span class="s2">hello</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// arguments not checkd</span>
 <span class="c1">// const f2 = ExecuteActivity(SomeSideEffect, 42, "hello", "something else"); // no compiler error</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">result</span><span class="p">,</span> <span class="nx">error</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Get</span><span class="p">();</span>
  <span class="c1">//       ^ bool,  ^ string</span>
<span class="p">}</span>
</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">ExecuteActivity</code> and the accepts the arguments as <code class="language-plaintext highlighter-rouge">any[]</code> which means no type-checking is done. The <code class="language-plaintext highlighter-rouge">Activity</code> type only accepts a <code class="language-plaintext highlighter-rouge">TResult</code> parameter and also accepts any arguments via <code class="language-plaintext highlighter-rouge">...args: any</code>.<p>Getting this behavior is not possible in Go. At runtime defining the arguments for a function type as <code class="language-plaintext highlighter-rouge">...interface{}</code> kind of behaves like <code class="language-plaintext highlighter-rouge">...any[]</code> in TypeScript, but not at compile time. So something like this:<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Activity</span><span class="p">[</span><span class="n">TResult</span> <span class="n">any</span><span class="p">]</span> <span class="k">func</span><span class="p">(</span><span class="o">...</span><span class="k">interface</span><span class="p">{})</span> <span class="n">TResult</span>

<span class="k">func</span> <span class="n">SomeSideEffect</span><span class="p">(</span><span class="n">a</span> <span class="kt">int</span><span class="p">,</span> <span class="n">f</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">a</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">ExecuteActivity</span><span class="p">[</span><span class="n">TResult</span> <span class="n">any</span><span class="p">](</span><span class="n">a</span> <span class="n">Activity</span><span class="p">[</span><span class="n">TResult</span><span class="p">])</span> <span class="p">{</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">ExecuteActivity</span><span class="p">(</span><span class="n">SomeSideEffect</span><span class="p">)</span>
	<span class="c">// type func(a int, f string) int of SomeSideEffect does not match Activity[TResult] (cannot infer TResult)</span>

	<span class="k">var</span> <span class="n">a</span> <span class="n">Activity</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">SomeSideEffect</span>
	<span class="c">// cannot use SomeSideEffect (value of type func(a int, f string) int) as type Activity[int] in variable declaration</span>
<span class="p">}</span>
</code></pre></div></div><p>will result in compiler errors. Basically there is no way of saying: ignore the arguments/parameters of the function, I’m only interested in the return type.<h3 id="go-generics---approach-2-restrict-activity-functions">Go Generics - Approach 2: restrict activity functions</h3><p>Another attempt was to restrict Activities to have at most one input parameter and one result. That works, but requires defining a lot of custom types for activities that accept more than one input. It’s similar to what DurableTask does in C# (at least for some overloads), but I wanted to preserve the notion that activites are (mostly) just plain Go functions.<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Act</span><span class="p">[</span><span class="n">TInput</span><span class="p">,</span> <span class="n">TResult</span> <span class="n">any</span><span class="p">]</span> <span class="k">func</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">TInput</span><span class="p">)</span> <span class="n">TResult</span>

<span class="k">func</span> <span class="n">ExecuteActivity</span><span class="p">[</span><span class="n">TInput</span><span class="p">,</span> <span class="n">TResult</span> <span class="n">any</span><span class="p">](</span><span class="n">act</span> <span class="n">Act</span><span class="p">[</span><span class="n">TInput</span><span class="p">,</span> <span class="n">TResult</span><span class="p">],</span> <span class="n">a1</span> <span class="n">TInput</span><span class="p">)</span> <span class="n">Future</span><span class="p">[</span><span class="n">TResult</span><span class="p">]</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">r</span> <span class="n">TResult</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">future</span><span class="p">[</span><span class="n">TResult</span><span class="p">]{</span><span class="n">r</span><span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">SomeSideEffect</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">a</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="m">42</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">r</span> <span class="o">:=</span> <span class="n">ExecuteActivity</span><span class="p">(</span><span class="n">SomeSideEffect</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">)</span> <span class="c">// r is future[int]</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%T"</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
	<span class="n">r</span> <span class="o">:=</span> <span class="n">ExecuteActivity</span><span class="p">(</span><span class="n">SomeSideEffect</span><span class="p">,</span> <span class="m">23</span><span class="p">)</span>
	<span class="c">// cannot use 23 (untyped int constant) as string value in argument to ExecuteActivity</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="go-generics---approach-3-manually-specify-the-result-type">Go Generics - Approach 3: manually specify the result type:</h3><p>This would allow to at least have a type-safe result, but at those cost of requiring the user to specify the result type. Argument type checking<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">ExecuteActivity</span><span class="p">[</span><span class="n">T</span> <span class="n">any</span><span class="p">](</span><span class="n">act</span> <span class="k">interface</span><span class="p">{},</span> <span class="n">args</span> <span class="o">...</span><span class="k">interface</span><span class="p">{})</span> <span class="n">Future</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">r</span> <span class="n">T</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">future</span><span class="p">[</span><span class="n">T</span><span class="p">]{</span><span class="n">r</span><span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">SomeSideEffect</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">a</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="m">42</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">r</span> <span class="o">:=</span> <span class="n">ExecuteActivity</span><span class="p">[</span><span class="kt">int</span><span class="p">](</span><span class="n">SomeSideEffect</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">)</span> <span class="c">// r is future[int]</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%T"</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="go-generics---approach-4-result-and-type-safe-arguments">Go Generics - Approach 4: result and type-safe arguments</h3><p>The generics proposal kind of mentions scenarios that require variadic generic paremeters in the <a href="https://go.googlesource.com/proposal/+/refs/heads/master/design/43651-type-parameters.md#metrics">Metrics</a> example. As a work-around the proposal recommends multiple “overloads”. Since Go doesn’t support overloading, you need differently named functions, for example <code class="language-plaintext highlighter-rouge">ExecuteActivity1</code>, <code class="language-plaintext highlighter-rouge">ExecuteActivity2</code>, <code class="language-plaintext highlighter-rouge">ExecuteActivityN</code>, with <code class="language-plaintext highlighter-rouge">N</code> indicating the number of arguments the activity acepts.<p>It’s not a great API to write, but some of it could be code generated. Example implementation for up to <code class="language-plaintext highlighter-rouge">N=3</code> (<a href="https://gotipplay.golang.org/p/hTY9OcVBciU">Gotip playground</a>):<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="s">"fmt"</span>

<span class="k">type</span> <span class="n">Future</span><span class="p">[</span><span class="n">T</span> <span class="n">any</span><span class="p">]</span> <span class="k">interface</span> <span class="p">{</span>
	<span class="n">Get</span><span class="p">()</span> <span class="n">T</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">future</span><span class="p">[</span><span class="n">T</span> <span class="n">any</span><span class="p">]</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">v</span> <span class="n">T</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">future</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="n">Get</span><span class="p">()</span> <span class="n">T</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">v</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">Act1</span><span class="p">[</span><span class="n">P1</span><span class="p">,</span> <span class="n">T</span> <span class="n">any</span><span class="p">]</span> <span class="k">func</span><span class="p">(</span><span class="n">P1</span><span class="p">)</span> <span class="n">T</span>
<span class="k">type</span> <span class="n">Act2</span><span class="p">[</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">T</span> <span class="n">any</span><span class="p">]</span> <span class="k">func</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">)</span> <span class="n">T</span>
<span class="k">type</span> <span class="n">Act3</span><span class="p">[</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">T</span> <span class="n">any</span><span class="p">]</span> <span class="k">func</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">)</span> <span class="n">T</span>

<span class="k">func</span> <span class="n">ExecuteActivity</span><span class="p">[</span><span class="n">P1</span><span class="p">,</span> <span class="n">T</span> <span class="n">any</span><span class="p">](</span><span class="n">act</span> <span class="n">Act1</span><span class="p">[</span><span class="n">P1</span><span class="p">,</span> <span class="n">T</span><span class="p">],</span> <span class="n">a1</span> <span class="n">P1</span><span class="p">)</span> <span class="n">Future</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">executeActivity</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">act</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">ExecuteActivity2</span><span class="p">[</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">T</span> <span class="n">any</span><span class="p">](</span><span class="n">act</span> <span class="n">Act2</span><span class="p">[</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">T</span><span class="p">],</span> <span class="n">a1</span> <span class="n">P1</span><span class="p">,</span> <span class="n">a2</span> <span class="n">P2</span><span class="p">)</span> <span class="n">Future</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">executeActivity</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">act</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">ExecuteActivity3</span><span class="p">[</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">T</span> <span class="n">any</span><span class="p">](</span><span class="n">act</span> <span class="n">Act3</span><span class="p">[</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">,</span> <span class="n">T</span><span class="p">],</span> <span class="n">a1</span> <span class="n">P1</span><span class="p">,</span> <span class="n">a2</span> <span class="n">P2</span><span class="p">,</span> <span class="n">a3</span> <span class="n">P3</span><span class="p">)</span> <span class="n">Future</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">executeActivity</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">act</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">executeActivity</span><span class="p">[</span><span class="n">T</span> <span class="n">any</span><span class="p">](</span><span class="n">f</span> <span class="n">activity</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">args</span> <span class="o">...</span><span class="k">interface</span><span class="p">{})</span> <span class="n">Future</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">r</span> <span class="n">T</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">future</span><span class="p">[</span><span class="n">T</span><span class="p">]{</span><span class="n">r</span><span class="p">}</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">activity</span><span class="p">[</span><span class="n">T</span> <span class="n">any</span><span class="p">]</span> <span class="k">interface</span><span class="p">{}</span>

<span class="k">func</span> <span class="n">SomeSideEffect</span><span class="p">(</span><span class="n">a</span> <span class="kt">int</span><span class="p">,</span> <span class="n">f</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">a</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">r</span> <span class="o">:=</span> <span class="n">ExecuteActivity2</span><span class="p">(</span><span class="n">SomeSideEffect</span><span class="p">,</span> <span class="m">42</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">)</span> <span class="c">// r is future[int]</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%T"</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

	<span class="c">// compiler error: cannot use 23 (untyped int constant) as string value in argument to ExecuteActivity2</span>
	<span class="c">//	r := ExecuteActivity2(SomeSideEffect, 42, 23)</span>
<span class="p">}</span>
</code></pre></div></div><p>As you can see, the return type is correctly inferred, the count of the arguments passed is evaluated, and the types are checked. A user of the API has to call the right “overload” meaning the version of <code class="language-plaintext highlighter-rouge">ExecuteActivityN</code> that matches the number of arguments the activity expects. And there also has to exist a matching <code class="language-plaintext highlighter-rouge">N</code> in the first place.<p>I’m not super happy with this yet, but it at least reduces the cognitive burden when working with the API. You don’t have to remember the number of arguments, their types, and the type of the result, you only have to make sure you pick the right overload.<p>The internal implementation can continue to use the current <code class="language-plaintext highlighter-rouge">args ...interface{}</code> behavior for the most part.<h3 id="summary">Summary</h3><p>Overall I’m pretty excited about Generics. Support for more complex scenarios is not yet there, but in my opinion, the fewer <code class="language-plaintext highlighter-rouge">interface{}</code> runtime conversions we need, the better. For my project being able to have the custom primitives (<code class="language-plaintext highlighter-rouge">Future</code>, <code class="language-plaintext highlighter-rouge">Channel</code>, etc.) become type-safe is a big improvement and brings them closer to the developer experience of the native types.</article><hr class="dingbat related mb6" /><aside class="related mb4" role="complementary"><h2 class="hr-bottom">Related Posts</h2><ul class="related-posts"><li class="h4"> <a href="/blog/2023-01-11-effective-workflow/" class="flip-title"><span>Effective Workflow GitHub CLI extension</span></a> <time class="faded fine" datetime="2023-01-11T00:00:00+00:00">11 Jan 2023</time><li class="h4"> <a href="/blog/2022-05-02-go-workflows-part2/" class="flip-title"><span>go-workflows: Durable Workflows in Go Part 2</span></a> <time class="faded fine" datetime="2022-05-02T00:00:00+00:00">02 May 2022</time><li class="h4"> <a href="/blog/2022-04-08-task-queue-with-redis/" class="flip-title"><span>Simple task queue with Redis Streams</span></a> <time class="faded fine" datetime="2022-04-08T16:30:00+00:00">08 Apr 2022</time></ul></aside><footer class="content" role="contentinfo"><hr/><p><small class="copyright">© 2023 Christopher Schleiden. All rights reserved. </small><p><small>Powered by <a class="external" href="https://hydejack.com/">Hydejack</a> v<span id="_version">9.1.6</span></small><hr class="sr-only"/></footer></main><hy-drawer id="_drawer" class="" side="left" threshold="10" noscroll ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg sidebar-overlay" style="background-color:rgb(25,55,71);background-image:url(/assets/img/sidebar-bg.jpg)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/" tabindex="-1"> <img src="/assets/icons/icon.png" class="avatar" alt="cschleiden" width="120" height="120" loading="lazy" /> </a> <a class="sidebar-title" href="/"><h2 class="h1">cschleiden</h2></a><p class="fine"> Software engineer at GitHub, previously at MSFT. Born and raised in Cologne, Germany. Loves climbing mountains in the PNW!</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_drawer--opened" href="/" class="sidebar-nav-item " > Blog </a><li> <a href="/projects" class="sidebar-nav-item " > Projects </a><li> <a href="/about" class="sidebar-nav-item " > About </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://twitter.com/cschleiden" title="Twitter" class="no-mark-external"> <span class="icon-twitter"></span> <span class="sr-only">Twitter</span> </a><li> <a href="https://github.com/cschleiden" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="https://www.linkedin.com/in/cschleiden" title="LinkedIn" class="no-mark-external"> <span class="icon-linkedin2"></span> <span class="sr-only">LinkedIn</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}(); </script> <script src="/assets/js/hydejack-9.1.6.js" type="module"></script> <script src="/assets/js/LEGACY-hydejack-9.1.6.js" nomodule defer></script> <script>!function(w, d) { w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; /**/ ga('create', 'UA-143333457-1', 'auto'); /**/ var pushStateEl = d.getElementById('_pushState'); var timeoutId; pushStateEl.addEventListener('hy-push-state-load', function() { w.clearTimeout(timeoutId); timeoutId = w.setTimeout(function() { ga('set', 'page', w.location.pathname); ga('send', 'pageview'); }, 500); }); d.addEventListener('hy--cookies-ok', function () { w.ga(function(tracker) { w.ga("set", "anonymizeIp", undefined); localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId")); }); }); w.loadJSDeferred('https://www.google-analytics.com/analytics.js'); }(window, document);</script> <!--<![endif]--><div hidden><h2 class="sr-only">Templates (for web app):</h2><template id="_animation-template"><div class="animation-main fixed-top"><nav id="breadcrumbs" class="screen-only"><ul></ul></nav><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Error</h1><p class="lead"> Sorry, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="icon-link"></span> </a> </template></div></html>
